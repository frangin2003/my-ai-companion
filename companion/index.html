<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kawaii SD Character</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Speech Bubble - Above Avatar's Ornament -->
    <div id="speech-bubble">
        <div id="speech-bubble-text"></div>
        <div class="speech-bubble-tail"></div>
    </div>
    
    <!-- Waveform Visualization (Feature 3) - Shows when recording -->
    <div id="waveform-container">
        <canvas id="waveform-canvas"></canvas>
    </div>
    
    <!-- Bottom Controls - Below Avatar -->
    <div id="bottom-controls">
        <!-- Toggle Text Input Button -->
        <button id="toggle-textbox-btn" class="toggle-btn" title="Toggle text input (T)">
            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
            <span>Chat</span>
        </button>
        
        <!-- Text Input (Hidden by default) -->
        <div id="text-input-container" class="hidden">
            <input type="text" id="text-input" placeholder="Type a message... (Enter to send)" autocomplete="off">
            <button id="send-text-btn" class="comm-btn send-btn" title="Send message">
                <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
        
        <!-- PTT Hint -->
        <div class="ptt-hint">
            <span class="key-hint">Right Shift</span> to talk
        </div>
    </div>
    
    <div id="ui-panel">
        <h2>ğŸ­ Avatar Controls</h2>
        
        <div class="section">
            <label class="checkbox-label">
                <input type="checkbox" id="debug-toggle"> 
                <span>Debug Mode</span>
            </label>
        </div>
        
        <div class="section">
            <h3>Expressions</h3>
            <div class="expression-grid">
                <!-- Row 0 -->
                <label class="expression-label"><input type="radio" name="expression" value="neutral" checked><span class="face-preview" data-col="0" data-row="0"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="happy"><span class="face-preview" data-col="1" data-row="0"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="wink"><span class="face-preview" data-col="2" data-row="0"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="sleepy"><span class="face-preview" data-col="3" data-row="0"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="worried"><span class="face-preview" data-col="4" data-row="0"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="surprised"><span class="face-preview" data-col="5" data-row="0"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="shocked"><span class="face-preview" data-col="6" data-row="0"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="angry"><span class="face-preview" data-col="7" data-row="0"></span></label>
                <!-- Row 1 -->
                <label class="expression-label"><input type="radio" name="expression" value="neutral2"><span class="face-preview" data-col="0" data-row="1"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="closed"><span class="face-preview" data-col="1" data-row="1"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="squint"><span class="face-preview" data-col="2" data-row="1"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="sad"><span class="face-preview" data-col="3" data-row="1"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="cry"><span class="face-preview" data-col="4" data-row="1"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="fear"><span class="face-preview" data-col="5" data-row="1"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="annoyed"><span class="face-preview" data-col="6" data-row="1"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="grumpy"><span class="face-preview" data-col="7" data-row="1"></span></label>
                <!-- Row 2 -->
                <label class="expression-label"><input type="radio" name="expression" value="talking1"><span class="face-preview" data-col="0" data-row="2"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="talking2"><span class="face-preview" data-col="1" data-row="2"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="excited"><span class="face-preview" data-col="2" data-row="2"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="love"><span class="face-preview" data-col="3" data-row="2"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="sparkle"><span class="face-preview" data-col="4" data-row="2"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="dizzy"><span class="face-preview" data-col="5" data-row="2"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="smirk"><span class="face-preview" data-col="6" data-row="2"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="meh"><span class="face-preview" data-col="7" data-row="2"></span></label>
                <!-- Row 3 -->
                <label class="expression-label"><input type="radio" name="expression" value="talking3"><span class="face-preview" data-col="0" data-row="3"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="bored"><span class="face-preview" data-col="1" data-row="3"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="thinking"><span class="face-preview" data-col="2" data-row="3"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="confused"><span class="face-preview" data-col="3" data-row="3"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="tired"><span class="face-preview" data-col="4" data-row="3"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="dead"><span class="face-preview" data-col="5" data-row="3"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="sassy"><span class="face-preview" data-col="6" data-row="3"></span></label>
                <label class="expression-label"><input type="radio" name="expression" value="rage"><span class="face-preview" data-col="7" data-row="3"></span></label>
            </div>
        </div>
        
        <div class="section">
            <button id="talk-btn" class="talk-button">ğŸ—£ï¸ Start Talking</button>
        </div>
        
        <div class="section">
            <h3>Animations</h3>
            <div class="anim-grid">
                <button class="anim-btn active" data-anim="idle">ğŸ˜Š Idle</button>
                <button class="anim-btn" data-anim="dance">ğŸ’ƒ Dance</button>
                <button class="anim-btn" data-anim="yata">ğŸ‰ Yata!</button>
                <button class="anim-btn" data-anim="sleep">ğŸ˜´ Sleep</button>
                <button class="anim-btn" data-anim="walk">ğŸš¶ Walk</button>
                <button class="anim-btn" data-anim="run">ğŸƒ Run</button>
                <button class="anim-btn" data-anim="float">âœ¨ Float</button>
                <button class="anim-btn" data-anim="roll">ğŸ©° Spin</button>
                <button class="anim-btn" data-anim="wave">ğŸ‘‹ Wave</button>
            </div>
        </div>
        
        <div class="section">
            <h3>State Tests (SERVER_SPEC.md)</h3>
            <div class="state-grid">
                <button class="state-test-btn" data-test="thinking_start">ğŸ¤” Thinking Start</button>
                <button class="state-test-btn" data-test="suggestion">ğŸ’¡ Suggestion</button>
                <button class="state-test-btn" data-test="reply">ğŸ’¬ Reply</button>
            </div>
        </div>
        
        <div class="section">
            <h3>State Tests (Legacy)</h3>
            <div class="state-grid">
                <button class="state-test-btn" data-test="idle">ğŸ˜Š Idle</button>
                <button class="state-test-btn" data-test="listening">ğŸ‘‚ Listening</button>
                <button class="state-test-btn" data-test="thinking">ğŸ¤” Thinking</button>
                <button class="state-test-btn" data-test="speaking">ğŸ—£ï¸ Speaking</button>
                <button class="state-test-btn" data-test="processing">âš™ï¸ Processing</button>
                <button class="state-test-btn" data-test="error">âŒ Error</button>
                <button class="state-test-btn" data-test="happy">ğŸ˜„ Happy</button>
                <button class="state-test-btn" data-test="sad">ğŸ˜¢ Sad</button>
                <button class="state-test-btn" data-test="excited">ğŸ‰ Excited</button>
                <button class="state-test-btn" data-test="sleepy">ğŸ˜´ Sleepy</button>
            </div>
        </div>
    </div>
    
    <div id="canvas-container"></div>

    <!-- Import maps polyfill -->
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module" src="main.js"></script>
</body>
</html>
